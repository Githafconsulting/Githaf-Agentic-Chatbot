services:
  - type: web
    name: githaf-agentic-chatbot
    env: python
    region: frankfurt
    buildCommand: |
      #!/usr/bin/env bash
      set -o errexit

      # 1. Install system dependencies required by Playwright
      apt-get update && apt-get install -y \
          wget curl libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 \
          libxkbcommon0 libxcomposite1 libxdamage1 libxrandr2 libgbm1 libasound2 \
          fonts-liberation libappindicator3-1 libxss1 xdg-utils

      # 2. Upgrade pip and install dependencies
      pip install --upgrade pip
      pip install -r requirements.txt

      # 3. Install Chromium for Playwright
      python -m playwright install --with-deps chromium

    startCommand: |
      python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT

    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
